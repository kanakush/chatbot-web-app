<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Door_Openbot ‚Äî Control Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style id="theme-style">
    /* –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ª–µ–≥–∫–æ–π —Å–º–µ–Ω—ã —Ç–µ–º */
    :root {
        --bg-body: #000000;
        --bg-card: #0a0a0a;
        --border-color: #222222;
        --text-main: #ffffff;
        --text-muted: #ffffff; /* –ò–°–ü–†–ê–í–õ–ï–ù–û: –±–µ–ª—ã–π —Ü–≤–µ—Ç –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã */
        --input-bg: #000000;
        --btn-grey: #cccccc;
        --table-hover: #151515;
    }

    [data-theme="light"] {
        --bg-body: #f4f7f6;
        --bg-card: #ffffff;
        --border-color: #dee2e6;
        --text-main: #212529;
        --text-muted: #6c757d; /* –û–°–¢–ê–í–õ–ï–ù–û: —Å–µ—Ä—ã–π —Ü–≤–µ—Ç –¥–ª—è —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º—ã */
        --input-bg: #ffffff;
        --btn-grey: #6c757d;
        --table-hover: #f8f9fa;
    }

    body {
        background-color: var(--bg-body);
        color: var(--text-main);
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        transition: background-color 0.3s, color 0.3s;
        min-height: 100vh;
    }

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã */
    .table-container, .card {
        background-color: var(--bg-card) !important;
        border: 1px solid var(--border-color) !important;
        border-radius: 8px;
        padding: 15px;
        transition: background-color 0.3s;
    }

    /* –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ */
    .table {
        --bs-table-bg: transparent !important;
        --bs-table-color: var(--text-main) !important;
        border-color: var(--border-color) !important;
        margin-bottom: 0;
        vertical-align: middle;
    }

    .table td, .table th {
        padding: 6px 10px !important;
        font-size: 0.85rem;
        line-height: 1.2;
        background-color: transparent !important;
        border-bottom: 1px solid var(--border-color) !important;
    }

    /* –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–´–ô –¶–í–ï–¢ –î–õ–Ø –î–ê–¢–´ –ò ID */
    /* –≠—Ç–æ –ø—Ä–∞–≤–∏–ª–æ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—ã —Å –∫–ª–∞—Å—Å–∞–º–∏ Bootstrap .text-muted –∏ .small —Å–ª—É—à–∞—Ç—å—Å—è –Ω–∞—à–µ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π */
    .table td.text-muted,
    .table td .small,
    .table td small {
        color: var(--text-muted) !important;
        opacity: 0.9; /* –ù–µ–±–æ–ª—å—à–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –¥–ª—è –º—è–≥–∫–æ—Å—Ç–∏, –Ω–æ —Ü–≤–µ—Ç –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–ª—ã–º */
    }

    .table thead th {
        background-color: rgba(128, 128, 128, 0.1) !important;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.75rem;
        letter-spacing: 0.5px;
    }

    /* –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤: –ø–æ–¥—Å–≤–µ—Ç–∫–∞ —Å—Ç—Ä–æ–∫–∏ */
    .table-hover tbody tr:hover td {
        background-color: var(--table-hover) !important;
        transition: 0.15s;
    }

    /* –ü–æ–ª—è –≤–≤–æ–¥–∞ */
    .form-control, .form-select {
        background-color: var(--input-bg) !important;
        border: 1px solid var(--border-color) !important;
        color: var(--text-main) !important;
        font-size: 0.85rem;
    }

    /* –ö–Ω–æ–ø–∫–∏ */
    .btn-strict {
        background-color: var(--btn-grey) !important;
        color: #000 !important;
        border: none;
        font-weight: 600;
        font-size: 0.85rem;
    }

    [data-theme="light"] .btn-strict { color: #fff !important; }

    /* –°—Ç–∞—Ç—É—Å—ã */
    .badge-open { border: 1px solid #28a745; color: #28a745; background: none; padding: 4px 8px; }
    .badge-close { border: 1px solid #dc3545; color: #dc3545; background: none; padding: 4px 8px; }

    code { background: rgba(128,128,128,0.2); color: var(--text-main); padding: 2px 5px; border-radius: 4px; }

    /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã */
    .theme-switch {
        cursor: pointer;
        padding: 5px 12px;
        border-radius: 20px;
        border: 1px solid var(--border-color);
        background: var(--bg-card);
        color: var(--text-main);
        font-size: 0.8rem;
    }

    /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
    .modal-content {
        background-color: var(--bg-card);
        color: var(--text-main);
        border: 1px solid var(--border-color);
    }
    .btn-close { filter: var(--close-filter, invert(1)); }
    [data-theme="light"] { --close-filter: invert(0); }
</style>
</head>
<body class="container py-4">

    <div class="d-flex justify-content-between align-items-start mb-4">
        <div>
            <h2 class="fw-bold mb-0">Door_Openbot</h2>
            <div class="d-flex align-items-center gap-2 mt-1">
                <span class="badge bg-dark border border-secondary">{{ role }}</span>
                <small class="text-muted">User: <strong class="text-main">{{ request.session.user }}</strong></small>
            </div>
        </div>
        <div class="d-flex gap-2">
            <button class="theme-switch" onclick="toggleTheme()" id="theme-btn">üåô Dark Mode</button>
            <a href="/logout" class="btn btn-sm btn-outline-danger">–í—ã—Ö–æ–¥</a>
        </div>
    </div>

    <div class="card mb-3 shadow-sm">
        <form class="row g-2" method="get" action="/dashboard">
            <div class="col-md-2">
                <input type="text" name="site_id" class="form-control" placeholder="SITEID" value="{{ filters.site_id or '' }}">
            </div>
            <div class="col-md-2">
                <select name="status" class="form-select">
                    <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                    <option value="open" {% if filters.status == 'open' %}selected{% endif %}>open</option>
                    <option value="close" {% if filters.status == 'close' %}selected{% endif %}>close</option>
                </select>
            </div>
            <div class="col-md-2">
                <input type="date" name="date_from" class="form-control" value="{{ filters.date_from or '' }}">
            </div>
            <div class="col-md-2">
                <input type="date" name="date_to" class="form-control" value="{{ filters.date_to or '' }}">
            </div>
            <div class="col-md-4 d-flex gap-2">
                <button type="submit" class="btn btn-strict flex-grow-1">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                <a href="/dashboard" class="btn btn-sm btn-outline-secondary d-flex align-items-center">–°–±—Ä–æ—Å</a>
            </div>
        </form>
    </div>

    <div class="table-container shadow-sm">
        <table class="table table-hover align-middle">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>SITEID</th>
                    <th>–§–∞–º–∏–ª–∏—è</th>
                    <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–∞—Ç–∞ / –í—Ä–µ–º—è</th>
                    <th class="text-end">–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for row in rows %}
                <tr>
                    <td class="text-muted">{{ row[0] }}</td>
                    <td><strong class="text-main">{{ row[1] }}</strong></td>
                    <td>{{ row[2] }}</td>
                    <td><code>{{ row[3] }}</code></td>
                    <td>
                        <span class="badge {{ 'badge-open' if row[4] == 'open' else 'badge-close' }}">
                            {{ row[4] }}
                        </span>
                    </td>
                    <td class="text-muted" style="font-size: 0.75rem;">{{ row[5] }}<br>{{ row[6] }}</td>
                    <td class="text-end">
                        <button type="button" class="btn btn-sm btn-strict" data-bs-toggle="modal" data-bs-target="#editModal{{ row[0] }}">‚úèÔ∏è</button>
                        <a href="/delete/{{ row[0] }}" class="btn btn-sm btn-outline-danger ms-1">üóëÔ∏è</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {% for row in rows %}
    <div class="modal fade" id="editModal{{ row[0] }}" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <form action="/edit/{{ row[0] }}" method="post" class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">–ü—Ä–∞–≤–∫–∞ #{{ row[0] }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-2">
                        <label class="form-label small">SITEID</label>
                        <input type="text" name="site_id" class="form-control" value="{{ row[1] }}" required>
                    </div>
                    <div class="mb-2">
                        <label class="form-label small">–§–∞–º–∏–ª–∏—è</label>
                        <input type="text" name="surname" class="form-control" value="{{ row[2] }}" required>
                    </div>
                    <div class="mb-2">
                        <label class="form-label small">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="text" name="phone" class="form-control" value="{{ row[3] }}" required>
                    </div>
                    <div class="mb-2">
                        <label class="form-label small">–°—Ç–∞—Ç—É—Å</label>
                        <select name="status" class="form-select">
                            <option value="open" {% if row[4] == 'open' %}selected{% endif %}>open</option>
                            <option value="close" {% if row[4] == 'close' %}selected{% endif %}>close</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-strict">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>
    {% endfor %}

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function toggleTheme() {
            const body = document.body;
            const btn = document.getElementById('theme-btn');
            const currentTheme = body.getAttribute('data-theme');

            if (currentTheme === 'light') {
                body.removeAttribute('data-theme');
                btn.innerHTML = 'üåô Dark Mode';
                localStorage.setItem('theme', 'dark');
            } else {
                body.setAttribute('data-theme', 'light');
                btn.innerHTML = '‚òÄÔ∏è Light Mode';
                localStorage.setItem('theme', 'light');
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π —Ç–µ–º—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = () => {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                document.body.setAttribute('data-theme', 'light');
                document.getElementById('theme-btn').innerHTML = '‚òÄÔ∏è Light Mode';
            }
        }
    </script>
</body>
</html>